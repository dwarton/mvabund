<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mvabund">
<title>Using offsets with count data • mvabund</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using offsets with count data">
<meta property="og:description" content="mvabund">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mvabund</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">4.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mvabund.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions glossary</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Offsets.html">Using offsets with count data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/aliceyiwang/mvabund">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using offsets with count data</h1>
            
      
      
      <div class="d-none name"><code>Offsets.Rmd</code></div>
    </div>

    
    
<p>This vignette takes you through a case study where offsets are used
during analysis with <code>mvabund</code>. We recommend reading the
“Analysing discrete data” chapter from the <a href="https://link.springer.com/book/10.1007/978-3-030-88443-7" class="external-link">Ecostats</a>
textbook.</p>
<p>Under some circumstances, we may tempted to standardise or average
our abundance counts across replicates before analysing them. Often this
is to account for differences in sampling intensity (different sized
plots, different numbers of replicates), but we caution users from doing
so! Standardisation/averaging counts can change the distribution of your
data, and affect the mean-variance relationship. Instead you should use
an <strong>offset</strong>, a term specially designed to account for
known sources of variation among replicates.</p>
<p>Lets take a look at a case study that uses an <strong>offset</strong>
in <code>mvabund</code></p>
<p>Anthony wants to evaluate how well earthworms numbers were doing
after some bush regeneration efforts. Here are some worm counts from
pitfall traps across each of 10 sites (where C=control, R=bush regen).
Notice there were only 4 pitfall traps at one site!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">worms</span>, <span class="st">"simple"</span><span class="op">)</span></span></code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="left">Treatment</td>
<td align="left">C</td>
<td align="left">R</td>
<td align="left">R</td>
<td align="left">R</td>
<td align="left">C</td>
<td align="left">R</td>
<td align="left">R</td>
<td align="left">R</td>
<td align="left">R</td>
<td align="left">R</td>
</tr>
<tr class="even">
<td align="left">Count</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">12</td>
<td align="left">1</td>
<td align="left">18</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left"># pitfalls</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">5</td>
<td align="left">4</td>
<td align="left">5</td>
<td align="left">5</td>
</tr>
</tbody></table>
<p>Anthony would like to model the number of worms
(<code>Haplotaxida</code>) from the <code>reveg</code> dataset as a
function of treatment (bush regeneration) while accounting variation in
sampling effort.</p>
<p>Lets load <code>mvabund</code> and the dataset first:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ecostats</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">reveg</span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach</a></span><span class="op">(</span><span class="va">reveg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html" class="external-link">skim</a></span><span class="op">(</span><span class="va">abund</span><span class="op">$</span><span class="va">Haplotaxida</span><span class="op">)</span> <span class="co"># Great function to get an overview of the data</span></span></code></pre></div>
<table class="table">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">abund$Haplotaxida</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">10</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table">
<colgroup>
<col width="18%">
<col width="13%">
<col width="18%">
<col width="6%">
<col width="6%">
<col width="4%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">data</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.1</td>
<td align="right">6.01</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.5</td>
<td align="right">3</td>
<td align="right">18</td>
<td align="left">▇▁▁▁▁</td>
</tr></tbody>
</table>
<p>Now we will use the <code>manyglm</code> function. We specified
<code>family =  "negative.binomial"</code> as count data often follows a
negative binomial distribution. We have also included an offset term to
deal with the fact that sampling effort varied across sites – with 5
pitfall traps at most sites but just 4 at one site. Offsets are most
commonly used in a log-linear model, where an offset is a predictor
known to have an exactly proportional effect on the response. The offset
in Anthony’s model for is <code>log(pitfalls)</code>. By including this
term, our model changes from predicting mean abundance to modelling mean
abundance per pitfall trap. This is what you would be trying to do if
you averaged the counts across pitfalls prior to analysing them, but
using an offset achieves this without messing with the data and its
mean-variance relationship.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">worms_offset</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/manyglm.html">manyglm</a></span><span class="op">(</span><span class="va">Haplotaxida</span><span class="op">~</span><span class="va">treatment</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pitfalls</span><span class="op">)</span><span class="op">)</span>, family<span class="op">=</span><span class="st">"negative.binomial"</span>, data<span class="op">=</span><span class="va">abund</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">worms_offset</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time elapsed: 0 hr 0 min 0 sec</span></span>
<span><span class="co">#&gt; Analysis of Deviance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model: Haplotaxida ~ treatment + offset(log(pitfalls))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multivariate test:</span></span>
<span><span class="co">#&gt;             Res.Df Df.diff   Dev Pr(&gt;Dev)</span></span>
<span><span class="co">#&gt; (Intercept)      9                       </span></span>
<span><span class="co">#&gt; treatment        8       1 2.889    0.141</span></span>
<span><span class="co">#&gt; Arguments: P-value calculated using 999 iterations via PIT-trap resampling.</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yi Wang, Ulrike Naumann, Dirk Eddelbuettel, John Wilshire, David Warton.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
